<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://www.google.com/recaptcha/api.js?render=6LekKboUAAAAAKQHsZxhrCByUZzvWkDTw0Xdc_Ve"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="/jquery"></script>
    <link rel="stylesheet" href="/bootstrap/css/bootstrap.min.css" integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous">
    <script src="/bootstrap/js/bootstrap.min.js" integrity="sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd" crossorigin="anonymous"></script>
    <link rel="stylesheet" type="text/css" href="/styles.css" />
    <meta charset="UTF-8">
    <title>Think you are a cyber guy?</title>
    <script lang="javascript">
        pages = [
            'welcome',
            'quiz',
            'grade'
        ];
        queryIdsUsed = [];
        pageIdx = 0;

        function onBodyLoad(o) {
            cursorBlink = setInterval(function() {
                cursor = document.getElementById('cursor')
                if (cursor.style.backgroundColor == 'black') {
                    cursor.style.backgroundColor = 'lightgray';
                    cursor.style.color = 'black';
                }
                else {
                    cursor.style.backgroundColor = 'black';
                    cursor.style.color = 'lightgray';
                }
            }, 1000);
        }
        function moveToNextPage() {
            document.getElementById(pages[pageIdx]).style.display = 'none';
            pageIdx++;
            document.getElementById(pages[pageIdx]).style.display = 'block';
            getNextRandomQuestion();
        }
        function getNextRandomQuestion() {
            const http = new XMLHttpRequest();
            const url = '/get-random-question';
            http.open('POST', url);
            http.setRequestHeader('Content-Type', 'application/json');
            http.send(JSON.stringify({
                answered_questions_ids: queryIdsUsed
            }));
            http.onreadystatechange = (e) => {
                if (http.readyState == 4 && http.status == 200) {
                    // Get next question
                    questionObj = JSON.parse(http.response);
                    if (Array.isArray(questionObj) && questionObj.length == 0) {
                        moveToNextPage();
                        return;
                    }

                    // Display the question
                    question = 'Based on your experience, how would you classify (can be more than one) an incident of an <strong class="question-item">' + questionObj.description.charAt(0).toLowerCase() + questionObj.description.slice(1) + '</strong> (' +  questionObj.anomaly_type + '@' + questionObj.metric_name + ')?';
                    document.getElementById('question').innerHTML = question;
                    queryIdsUsed.push(questionObj.question_id);

                    // Get categories
                    const categoriesHttpGetter = new XMLHttpRequest();
                    const categoriesUrl = '/get-all-categories';
                    categoriesHttpGetter.open('GET', categoriesUrl);
                    categoriesHttpGetter.setRequestHeader('Content-Type', 'application/json');
                    categoriesHttpGetter.send();
                    categoriesHttpGetter.onreadystatechange = (e) => {
                        if (categoriesHttpGetter.readyState == 4 && categoriesHttpGetter.status == 200) {
                            categoriesOptionButtonsHolder = document.getElementById('categories');
                            categoriesOptionButtonsHolder.innerHTML = '';
                            categories = JSON.parse(categoriesHttpGetter.response).categories;
                            categories.forEach((category, index, array) => {
                                categoriesOptionButtonsHolder.innerHTML += '<div class="custom-control custom-checkbox"><input type="checkbox" class="custom-control-input" id="' + category['category_id'] + '" value="' + category['category_id'] + '" name="categories"><label class="custom-control-label" for="' + category['category_id'] + '">' + category['category_name'] + '</label></div>\n';
                            });
                        }
                    }
                }
            }
        }
        function onSubmitAnswer(o) {
            var selectedCategories = [];
            $.each($("input[name='categories']:checked"), function(){
                selectedCategories.push($(this).val());
            });

            const http = new XMLHttpRequest();
            const url = '/report-query/' + queryIdsUsed[queryIdsUsed.length - 1]
            http.open('POST', url);
            http.setRequestHeader('Content-Type', 'application/json');
            http.send(JSON.stringify({
                categories: selectedCategories
            }));

            http.onreadystatechange = (e) => {
                if (http.readyState == 4 && http.status == 200) {
                    getNextRandomQuestion();
                }
            }

            document.getElementById('go_to_grade_button').disabled = false;
        }
        function onGradeButton() {
            moveToNextPage();
        }
    </script>
</head>
<body id="body" onload="onBodyLoad(this);">
    <div class="container-fluid">
        <div class="row">
            <div class="col-xs-12">
                <div id="title" class="title">

                                                                                                                                                                                                                                                                                                                                                                         ???????
                                                                                                                                      bbbbbbbb                                                                                                                                                                                                                         ??:::::::??
BBBBBBBBBBBBBBBBB   EEEEEEEEEEEEEEEEEEEEEE   SSSSSSSSSSSSSSS TTTTTTTTTTTTTTTTTTTTTTT             CCCCCCCCCCCCC                        b::::::b                                                                                                                           EEEEEEEEEEEEEEEEEEEEEEVVVVVVVV           VVVVVVVVEEEEEEEEEEEEEEEEEEEEEERRRRRRRRRRRRRRRRR    ??:::::::::::?                             PPPPPPPPPPPPPPPPP                                                                                       iiii          tttt           !!!
B::::::::::::::::B  E::::::::::::::::::::E SS:::::::::::::::ST:::::::::::::::::::::T          CCC::::::::::::C                        b::::::b                                                                                                                           E::::::::::::::::::::EV::::::V           V::::::VE::::::::::::::::::::ER::::::::::::::::R  ?:::::????:::::?                            P::::::::::::::::P                                                                                     i::::i      ttt:::t          !!:!!
B::::::BBBBBB:::::B E::::::::::::::::::::ES:::::SSSSSS::::::ST:::::::::::::::::::::T        CC:::::::::::::::C                        b::::::b                                                                                                                           E::::::::::::::::::::EV::::::V           V::::::VE::::::::::::::::::::ER::::::RRRRRR:::::R ?::::?    ?::::?                            P::::::PPPPPP:::::P                                                                                     iiii       t:::::t          !:::!
BB:::::B     B:::::BEE::::::EEEEEEEEE::::ES:::::S     SSSSSSST:::::TT:::::::TT:::::T       C:::::CCCCCCCC::::C                         b:::::b                                                                                                                           EE::::::EEEEEEEEE::::EV::::::V           V::::::VEE::::::EEEEEEEEE::::ERR:::::R     R:::::R?::::?     ?::::?                           PP:::::P     P:::::P                                                                                               t:::::t          !:::!
  B::::B     B:::::B  E:::::E       EEEEEES:::::S            TTTTTT  T:::::T  TTTTTT      C:::::C       CCCCCCyyyyyyy           yyyyyyyb:::::bbbbbbbbb        eeeeeeeeeeee    rrrrr   rrrrrrrrr           ggggggggg   ggggguuuuuu    uuuuuuyyyyyyy           yyyyyyy       E:::::E       EEEEEE V:::::V           V:::::V   E:::::E       EEEEEE  R::::R     R:::::R??????     ?::::?                             P::::P     P:::::Prrrrr   rrrrrrrrr      ooooooooooo vvvvvvv           vvvvvvv eeeeeeeeeeee         iiiiiiittttttt:::::ttttttt    !:::!
  B::::B     B:::::B  E:::::E             S:::::S                    T:::::T             C:::::C               y:::::y         y:::::y b::::::::::::::bb    ee::::::::::::ee  r::::rrr:::::::::r         g:::::::::ggg::::gu::::u    u::::u y:::::y         y:::::y        E:::::E               V:::::V         V:::::V    E:::::E               R::::R     R:::::R          ?::::?                              P::::P     P:::::Pr::::rrr:::::::::r   oo:::::::::::oov:::::v         v:::::vee::::::::::::ee       i:::::it:::::::::::::::::t    !:::!
  B::::BBBBBB:::::B   E::::::EEEEEEEEEE    S::::SSSS                 T:::::T             C:::::C                y:::::y       y:::::y  b::::::::::::::::b  e::::::eeeee:::::eer:::::::::::::::::r       g:::::::::::::::::gu::::u    u::::u  y:::::y       y:::::y         E::::::EEEEEEEEEE      V:::::V       V:::::V     E::::::EEEEEEEEEE     R::::RRRRRR:::::R          ?::::?                               P::::PPPPPP:::::P r:::::::::::::::::r o:::::::::::::::ov:::::v       v:::::ve::::::eeeee:::::ee      i::::it:::::::::::::::::t    !:::!
  B:::::::::::::BB    E:::::::::::::::E     SS::::::SSSSS            T:::::T             C:::::C                 y:::::y     y:::::y   b:::::bbbbb:::::::be::::::e     e:::::err::::::rrrrr::::::r     g::::::ggggg::::::ggu::::u    u::::u   y:::::y     y:::::y          E:::::::::::::::E       V:::::V     V:::::V      E:::::::::::::::E     R:::::::::::::RR          ?::::?         ---------------        P:::::::::::::PP  rr::::::rrrrr::::::ro:::::ooooo:::::o v:::::v     v:::::ve::::::e     e:::::e      i::::itttttt:::::::tttttt    !:::!
  B::::BBBBBB:::::B   E:::::::::::::::E       SSS::::::::SS          T:::::T             C:::::C                  y:::::y   y:::::y    b:::::b    b::::::be:::::::eeeee::::::e r:::::r     r:::::r     g:::::g     g:::::g u::::u    u::::u    y:::::y   y:::::y           E:::::::::::::::E        V:::::V   V:::::V       E:::::::::::::::E     R::::RRRRRR:::::R        ?::::?          -:::::::::::::-        P::::PPPPPPPPP     r:::::r     r:::::ro::::o     o::::o  v:::::v   v:::::v e:::::::eeeee::::::e      i::::i      t:::::t          !:::!
  B::::B     B:::::B  E::::::EEEEEEEEEE          SSSSSS::::S         T:::::T             C:::::C                   y:::::y y:::::y     b:::::b     b:::::be:::::::::::::::::e  r:::::r     rrrrrrr     g:::::g     g:::::g u::::u    u::::u     y:::::y y:::::y            E::::::EEEEEEEEEE         V:::::V V:::::V        E::::::EEEEEEEEEE     R::::R     R:::::R      ?::::?           ---------------        P::::P             r:::::r     rrrrrrro::::o     o::::o   v:::::v v:::::v  e:::::::::::::::::e       i::::i      t:::::t          !:::!
  B::::B     B:::::B  E:::::E                         S:::::S        T:::::T             C:::::C                    y:::::y:::::y      b:::::b     b:::::be::::::eeeeeeeeeee   r:::::r                 g:::::g     g:::::g u::::u    u::::u      y:::::y:::::y             E:::::E                    V:::::V:::::V         E:::::E               R::::R     R:::::R      ?::::?                                  P::::P             r:::::r            o::::o     o::::o    v:::::v:::::v   e::::::eeeeeeeeeee        i::::i      t:::::t          !!:!!
  B::::B     B:::::B  E:::::E       EEEEEE            S:::::S        T:::::T              C:::::C       CCCCCC       y:::::::::y       b:::::b     b:::::be:::::::e            r:::::r                 g::::::g    g:::::g u:::::uuuu:::::u       y:::::::::y              E:::::E       EEEEEE        V:::::::::V          E:::::E       EEEEEE  R::::R     R:::::R      ??::??                                  P::::P             r:::::r            o::::o     o::::o     v:::::::::v    e:::::::e                 i::::i      t:::::t    tttttt !!!
BB:::::BBBBBB::::::BEE::::::EEEEEEEE:::::ESSSSSSS     S:::::S      TT:::::::TT             C:::::CCCCCCCC::::C        y:::::::y        b:::::bbbbbb::::::be::::::::e           r:::::r                 g:::::::ggggg:::::g u:::::::::::::::uu      y:::::::y             EE::::::EEEEEEEE:::::E         V:::::::V         EE::::::EEEEEEEE:::::ERR:::::R     R:::::R       ????                                 PP::::::PP           r:::::r            o:::::ooooo:::::o      v:::::::v     e::::::::e               i::::::i     t::::::tttt:::::t
B:::::::::::::::::B E::::::::::::::::::::ES::::::SSSSSS:::::S      T:::::::::T              CC:::::::::::::::C         y:::::y         b::::::::::::::::b  e::::::::eeeeeeee   r:::::r                  g::::::::::::::::g  u:::::::::::::::u       y:::::y              E::::::::::::::::::::E          V:::::V          E::::::::::::::::::::ER::::::R     R:::::R                                            P::::::::P           r:::::r            o:::::::::::::::o       v:::::v       e::::::::eeeeeeee       i::::::i     tt::::::::::::::t !!!
B::::::::::::::::B  E::::::::::::::::::::ES:::::::::::::::SS       T:::::::::T                CCC::::::::::::C        y:::::y          b:::::::::::::::b    ee:::::::::::::e   r:::::r                   gg::::::::::::::g   uu::::::::uu:::u      y:::::y               E::::::::::::::::::::E           V:::V           E::::::::::::::::::::ER::::::R     R:::::R       ???                                  P::::::::P           r:::::r             oo:::::::::::oo         v:::v         ee:::::::::::::e       i::::::i       tt:::::::::::tt!!:!!
BBBBBBBBBBBBBBBBB   EEEEEEEEEEEEEEEEEEEEEE SSSSSSSSSSSSSSS         TTTTTTTTTTT                   CCCCCCCCCCCCC       y:::::y           bbbbbbbbbbbbbbbb       eeeeeeeeeeeeee   rrrrrrr                     gggggggg::::::g     uuuuuuuu  uuuu     y:::::y                EEEEEEEEEEEEEEEEEEEEEE            VVV            EEEEEEEEEEEEEEEEEEEEEERRRRRRRR     RRRRRRR      ??:??                                 PPPPPPPPPP           rrrrrrr               ooooooooooo            vvv            eeeeeeeeeeeeee       iiiiiiii         ttttttttttt   !!!
                                                                                                                    y:::::y                                                                                        g:::::g                       y:::::y                                                                                                                   ???
                                                                                                                   y:::::y                                                                             gggggg      g:::::g                      y:::::y
                                                                                                                  y:::::y                                                                              g:::::gg   gg:::::g                     y:::::y
                                                                                                                 y:::::y                                                                                g::::::ggg:::::::g                    y:::::y
                                                                                                                yyyyyyy                                                                                  gg:::::::::::::g                    yyyyyyy
                                                                                                                                                                                                           ggg::::::ggg
                                                                                                                                                                                                              gggggg

                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12">
                <div id="welcome">
                    <div id="sub-title-wrapper" class="sub-title-wrapper">
                        <div id="sub-title" class="sub-title">If you'll choose to continue, you'll be presented with one metric behaviour at a time and asked to correctly classify it to one or more categories. You can leave the quiz at anytime by clicking the "Leave" button.</div>
                    </div>
                    <div id="continue-question" class="continue-question">Solve the following CAPTCHA to continue...</div><div id="cursor" class="cursor">&nbsp;</div>
                    <script>
                    grecaptcha.ready(function() {
                        grecaptcha.execute('6LekKboUAAAAAKQHsZxhrCByUZzvWkDTw0Xdc_Ve', {action: 'homepage'}).then(function(token) {
                           alert(token);
                           moveToNextPage();
                        });
                    });
                    </script>
                </div>
            </div>
        </div>
        <div id="quiz" class="quiz" style="display: none;">
            <div class="row">
                <div class="col-md-1">&nbsp;</div>
                <div class="col-md-10   ">
                    <div id="question" class="question">Loading...</div>
                    <div id="answers" class="answers"><div id="categories"></div></div>
                </div>
                <div class="col-md-1">&nbsp;</div>
            </div>
            <div class="row">
                <div id="submit_button_container" class="col-xs-12 submit_button_container">
                    <button class="btn btn-success btn-lg" id="submit_button" onclick="onSubmitAnswer(document.getElementById('quiz'))">Submit answer</button>
                    &nbsp;
                    <button class="btn btn-warning btn-lg" id="go_to_grade_button" onclick="onGradeButton()" disabled>Skip to grade</button>
                </div>
            </div>
        </div>
        <div id="grade" class="grade" style="display: none;">
            <div class="row">
                <div class="col-xs-12">
                    <div class="gradeNumber">85%</div>
                </div>
            </div>
            <div class="row">
                <div class="col-xs-12">of your answers were the same as other experts.</div>
            </div>
        </div>
    </div>
</body>
</html>